{% extends 'blog/base.html' %}

{% block title %}Post List{% endblock %}

{% block content %}
<div class="container">
    <h1>Post List</h1>

    <!-- Formulário de busca com ID para identificação -->
    <form method="GET" action="{% url 'post_list' %}" class="form-inline mb-4" id="search-form">
        <input type="text" name="q" id="search-input" placeholder="Search by title" value="{{ query }}" class="form-control mr-2">
    </form>

    <!-- Container onde os resultados serão carregados dinamicamente -->
    <ul id="post-list">
        {% for post in posts %}
        <li>
            <a href="{% url 'post_detail' pk=post.pk %}">{{ post.title }}</a>
        </li>
        {% empty %}
        <li class="list-group-item">No posts found.</li>
        {% endfor %}
    </ul>
</div>

<!-- Script para pesquisa AJAX -->
<script>
    document.getElementById('search-input').addEventListener('input', function() {
        const query = this.value;
        const xhr = new XMLHttpRequest();
        const url = "{% url 'post_list' %}?q=" + encodeURIComponent(query);  // Construir a URL com o parâmetro de busca

        xhr.open('GET', url, true);
        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');  // Define que é uma requisição AJAX

        xhr.onload = function() {
            if (xhr.status === 200) {
                const parser = new DOMParser();
                const doc = parser.parseFromString(xhr.responseText, 'text/html');
                const newPosts = doc.getElementById('post-list').innerHTML;  // Obtém o conteúdo da nova lista de posts
                document.getElementById('post-list').innerHTML = newPosts;   // Substitui o conteúdo atual
            }
        };

        xhr.send();
    });
</script>

{% endblock %}
